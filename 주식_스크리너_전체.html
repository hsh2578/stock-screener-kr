<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ì‹ ìŠ¤í¬ë¦¬ë„ˆ</title>
    <link rel="icon" type="image/svg+xml" href="./favicon.svg">
    <!-- Pretendard í°íŠ¸ (ë„¤ì´ë²„, ì¹´ì¹´ì˜¤, í† ìŠ¤ì—ì„œ ì‚¬ìš©í•˜ëŠ” í˜„ëŒ€ì ì¸ í•œê¸€ í°íŠ¸) -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <style>
        /* ============================================================
           MODERN FINANCIAL SCREENER - Professional UI/UX Design
           Inspired by Naver Finance & Yahoo Finance
           ============================================================ */

        :root {
            /* Light Theme Colors - Professional Financial Style */
            --color-bg-primary: #FFFFFF;
            --color-bg-secondary: #F8F9FA;
            --color-bg-tertiary: #EBEEF3;
            --color-bg-hover: #F0F2F5;
            --color-text-primary: #1E2329;
            --color-text-secondary: #5E6673;
            --color-text-muted: #8B95A1;
            --color-accent: #0066CC;
            --color-accent-hover: #004499;
            --color-accent-light: #E8F1FA;
            --color-success: #E31B1B;  /* í•œêµ­ì‹: ìƒìŠ¹ ë¹¨ê°• */
            --color-success-bg: rgba(227, 27, 27, 0.08);
            --color-danger: #1261C4;   /* í•œêµ­ì‹: í•˜ë½ íŒŒë‘ */
            --color-danger-bg: rgba(18, 97, 196, 0.08);
            --color-warning: #F59E0B;
            --color-warning-bg: rgba(245, 158, 11, 0.08);
            --color-border: #E5E8EB;
            --color-border-dark: #D1D5DB;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.04);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.12);
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            background-color: var(--color-bg-secondary);
            color: var(--color-text-primary);
            min-height: 100vh;
            line-height: 1.6;
            font-size: 15px;
            font-weight: 500;
            -webkit-font-smoothing: antialiased;
            letter-spacing: -0.01em;
        }

        a { color: var(--color-accent); text-decoration: none; transition: color 0.15s; }
        a:hover { color: var(--color-accent-hover); }

        /* ============================================================
           GLOBAL HEADER
           ============================================================ */
        .global-header {
            background: var(--color-bg-primary);
            border-bottom: 1px solid var(--color-border);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 56px;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            font-size: 18px;
            color: var(--color-text-primary);
            cursor: pointer;
        }
        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--color-accent) 0%, #0052A3 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
        }
        .header-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 13px;
            color: var(--color-text-muted);
        }
        .update-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: var(--color-bg-tertiary);
            border-radius: 20px;
            font-size: 12px;
        }
        .update-badge::before {
            content: '';
            width: 6px;
            height: 6px;
            background: #22C55E;
            border-radius: 50%;
        }

        /* ============================================================
           CARD SYSTEM
           ============================================================ */
        .card {
            background-color: var(--color-bg-primary);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            transition: all 0.2s ease;
        }
        .card:hover {
            border-color: var(--color-border-dark);
            box-shadow: var(--shadow-md);
        }

        /* ============================================================
           BADGE SYSTEM
           ============================================================ */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 3px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.02em;
        }
        .badge-success { background-color: var(--color-success-bg); color: var(--color-success); }
        .badge-warning { background-color: var(--color-warning-bg); color: #B45309; }
        .badge-danger { background-color: var(--color-danger-bg); color: var(--color-danger); }
        .badge-info { background-color: var(--color-accent-light); color: var(--color-accent); }

        /* ============================================================
           LAYOUT
           ============================================================ */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
            min-height: calc(100vh - 56px);
        }

        /* ============================================================
           HOME PAGE
           ============================================================ */
        .home-header {
            margin-bottom: 40px;
            text-align: center;
            padding: 48px 24px;
            background: linear-gradient(135deg, #F8FAFC 0%, #EEF2F6 100%);
            border-radius: var(--radius-lg);
            border: 1px solid var(--color-border);
        }
        .home-header h1 {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 12px;
            color: var(--color-text-primary);
            letter-spacing: -0.5px;
        }
        @media (min-width: 768px) { .home-header h1 { font-size: 36px; } }
        .home-header .subtitle {
            font-size: 16px;
            margin-bottom: 8px;
            color: var(--color-text-secondary);
            font-weight: 400;
        }
        .home-header .meta {
            font-size: 13px;
            color: var(--color-text-muted);
        }

        /* ============================================================
           SCREENER CARD GRID
           ============================================================ */
        .card-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
        }
        @media (min-width: 640px) { .card-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (min-width: 1024px) { .card-grid { grid-template-columns: repeat(3, 1fr); gap: 20px; } }

        .screener-card {
            display: block;
            padding: 20px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        .screener-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--color-accent);
            opacity: 0;
            transition: opacity 0.2s;
        }
        .screener-card:hover::before { opacity: 1; }
        .screener-card:hover { transform: translateY(-2px); }
        .screener-card .content { display: flex; align-items: flex-start; gap: 14px; }
        .screener-card .icon {
            width: 44px;
            height: 44px;
            border-radius: 10px;
            background: var(--color-bg-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }
        .screener-card .info { flex: 1; min-width: 0; }
        .screener-card .title-row { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; flex-wrap: wrap; }
        .screener-card h2 { font-size: 15px; font-weight: 700; color: var(--color-text-primary); }
        .screener-card .desc { font-size: 13px; color: var(--color-text-secondary); line-height: 1.5; }
        .screener-card .stock-count {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--color-border);
            font-size: 13px;
            color: var(--color-text-muted);
        }
        .screener-card .stock-count strong {
            color: var(--color-accent);
            font-weight: 700;
        }

        /* ============================================================
           FOOTER
           ============================================================ */
        .home-footer {
            margin-top: 48px;
            text-align: center;
            padding: 24px;
            background: var(--color-bg-primary);
            border-radius: var(--radius-md);
            border: 1px solid var(--color-border);
        }
        .home-footer p { font-size: 13px; color: var(--color-text-secondary); }
        .home-footer .disclaimer { font-size: 12px; margin-top: 8px; color: var(--color-text-muted); }

        /* ============================================================
           PAGE HEADER & NAVIGATION
           ============================================================ */
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 20px;
            font-size: 13px;
            font-weight: 500;
            color: var(--color-text-secondary);
            padding: 8px 14px;
            background: var(--color-bg-primary);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            transition: all 0.15s;
        }
        .back-link:hover {
            background: var(--color-bg-tertiary);
            color: var(--color-text-primary);
        }

        .page-header {
            background: var(--color-bg-primary);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
        }
        .page-header .title-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }
        .page-header .icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--color-accent-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        .page-header h1 {
            font-size: 22px;
            font-weight: 700;
            color: var(--color-text-primary);
            letter-spacing: -0.3px;
        }
        .page-header .desc {
            color: var(--color-text-secondary);
            font-size: 14px;
            margin-top: 4px;
        }
        .page-header .meta {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--color-border);
            font-size: 13px;
        }
        .page-header .meta .date { color: var(--color-text-muted); }
        .page-header .meta .count {
            font-weight: 700;
            color: var(--color-accent);
        }
        .page-header .meta .total { color: var(--color-text-muted); }

        /* ============================================================
           DATA TABLE - Naver Finance Style
           ============================================================ */
        .table-card {
            overflow: hidden;
            border-radius: var(--radius-md);
        }
        .table-card:hover { transform: none; box-shadow: var(--shadow-sm); }
        .table-wrapper { overflow-x: auto; }

        table { width: 100%; border-collapse: collapse; }

        th {
            background-color: var(--color-bg-tertiary);
            padding: 14px 14px;
            text-align: left;
            font-weight: 700;
            font-size: 13px;
            color: var(--color-text-primary);
            border-bottom: 2px solid var(--color-border-dark);
            white-space: nowrap;
            cursor: pointer;
            user-select: none;
            transition: background-color 0.15s;
        }
        th:hover { background-color: #DDE1E6; }
        th:first-child { padding-left: 20px; }
        th:last-child { padding-right: 20px; }

        td {
            padding: 14px;
            border-bottom: 1px solid var(--color-border);
            font-size: 14px;
            font-weight: 500;
            color: var(--color-text-primary);
        }
        td:first-child { padding-left: 20px; }
        td:last-child { padding-right: 20px; }

        /* ì¤„ë¬´ëŠ¬ (Zebra striping) - ë„¤ì´ë²„ ê¸ˆìœµ ìŠ¤íƒ€ì¼ */
        tbody tr:nth-child(even) { background-color: var(--color-bg-secondary); }
        tbody tr:nth-child(odd) { background-color: var(--color-bg-primary); }
        tbody tr:hover { background-color: #EDF4FC !important; }

        .text-right { text-align: right; font-variant-numeric: tabular-nums; }
        .text-center { text-align: center; }

        .stock-name {
            font-weight: 700;
            font-size: 14px;
            color: var(--color-text-primary);
            display: block;
        }
        .stock-ticker {
            font-size: 11px;
            color: var(--color-text-muted);
            font-weight: 400;
            font-variant-numeric: tabular-nums;
            letter-spacing: 0.02em;
        }

        /* ìƒìŠ¹/í•˜ë½ ìƒ‰ìƒ - í•œêµ­ì‹ */
        .positive { color: var(--color-success); font-weight: 700; }
        .negative { color: var(--color-danger); font-weight: 700; }
        .neutral { color: var(--color-text-secondary); font-weight: 500; }

        /* ê°€ê²© ì…€ ìŠ¤íƒ€ì¼ - Pretendardì˜ tabular numbers ì‚¬ìš© */
        .price-cell {
            font-variant-numeric: tabular-nums;
            font-weight: 600;
        }
        .change-cell {
            font-variant-numeric: tabular-nums;
            font-weight: 700;
        }

        /* ============================================================
           SECTOR STAGE SECTION
           ============================================================ */
        .stage-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }
        @media (min-width: 768px) { .stage-grid { grid-template-columns: repeat(4, 1fr); } }

        .stage-info {
            padding: 16px;
            text-align: center;
            background: var(--color-bg-primary);
        }
        .stage-info:hover { transform: none; }
        .stage-info .emoji { font-size: 24px; margin-bottom: 8px; }
        .stage-info .name { font-weight: 700; font-size: 14px; }
        .stage-info .sub { font-size: 12px; color: var(--color-text-muted); margin-top: 4px; }

        .sector-section { margin-bottom: 24px; }
        .sector-section h2 {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--color-text-primary);
        }
        .sector-section .section-badge {
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 4px;
            font-weight: 600;
        }
        .sector-cards {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }
        @media (min-width: 640px) { .sector-cards { grid-template-columns: repeat(2, 1fr); } }
        @media (min-width: 1024px) { .sector-cards { grid-template-columns: repeat(3, 1fr); } }
        @media (min-width: 1280px) { .sector-cards { grid-template-columns: repeat(4, 1fr); } }

        .sector-card {
            padding: 16px;
            transition: all 0.2s;
            background: var(--color-bg-primary);
        }
        .sector-card:hover { transform: translateY(-2px); }
        .sector-card .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .sector-card .sector-name { font-weight: 700; color: var(--color-text-primary); font-size: 14px; }
        .sector-card .stage-badge { display: flex; align-items: center; gap: 4px; }
        .sector-card .stage-badge .emoji { font-size: 16px; }
        .sector-card .stage-badge .name { font-size: 12px; font-weight: 600; }
        .sector-card .metrics { font-size: 13px; }
        .sector-card .metric { display: flex; justify-content: space-between; margin-bottom: 6px; }
        .sector-card .metric-label { color: var(--color-text-muted); }
        .sector-card .overheated {
            margin-top: 12px;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 11px;
            text-align: center;
            font-weight: 600;
            background-color: var(--color-success-bg);
            color: var(--color-success);
        }

        /* Stage colors */
        .stage-1 { color: var(--color-text-secondary); }
        .stage-2 { color: #16A34A; }
        .stage-3 { color: var(--color-warning); }
        .stage-4 { color: var(--color-danger); }
        .stage-1-bg { background-color: rgba(156, 163, 175, 0.1); border-color: rgba(156, 163, 175, 0.3); }
        .stage-2-bg { background-color: rgba(22, 163, 74, 0.1); border-color: rgba(22, 163, 74, 0.3); }
        .stage-3-bg { background-color: rgba(245, 158, 11, 0.1); border-color: rgba(245, 158, 11, 0.3); }
        .stage-4-bg { background-color: rgba(18, 97, 196, 0.1); border-color: rgba(18, 97, 196, 0.3); }

        /* ============================================================
           PAGE VISIBILITY
           ============================================================ */
        .page { display: none; }
        .page.active { display: block; }

        /* ============================================================
           SORT ICONS
           ============================================================ */
        th .sort-icon {
            margin-left: 4px;
            opacity: 0.3;
            font-size: 10px;
            transition: opacity 0.15s;
        }
        th:hover .sort-icon { opacity: 0.6; }
        th.sorted .sort-icon { opacity: 1; color: var(--color-accent); }

        /* ============================================================
           CLICKABLE ROWS
           ============================================================ */
        tr.clickable { cursor: pointer; }
        tr.clickable:hover { background-color: #EDF4FC !important; }

        /* ============================================================
           CHART MODAL
           ============================================================ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-overlay.active { display: flex; }
        .modal-content {
            background-color: var(--color-bg-primary);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            width: 100%;
            max-width: 960px;
            max-height: 90vh;
            overflow: hidden;
            animation: modalSlideIn 0.25s ease-out;
            box-shadow: var(--shadow-lg);
        }
        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 20px 24px;
            border-bottom: 1px solid var(--color-border);
            background: var(--color-bg-secondary);
        }
        .modal-stock-info h2 {
            font-size: 18px;
            font-weight: 700;
            color: var(--color-text-primary);
        }
        .modal-stock-info .ticker {
            font-size: 13px;
            color: var(--color-text-muted);
            margin-left: 8px;
            font-weight: 400;
        }
        .modal-stock-info .price-row {
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .modal-stock-info .price {
            font-size: 20px;
            font-weight: 700;
            font-variant-numeric: tabular-nums;
        }
        .modal-close {
            background: var(--color-bg-primary);
            border: 1px solid var(--color-border);
            color: var(--color-text-secondary);
            width: 36px; height: 36px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
        }
        .modal-close:hover {
            background: var(--color-bg-tertiary);
            color: var(--color-text-primary);
        }
        .modal-body { padding: 20px 24px; }
        .chart-container {
            background: #FAFBFC;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            height: 420px;
            position: relative;
        }
        .chart-loading {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: var(--color-text-muted);
            font-size: 14px;
        }
        .chart-legend {
            display: flex;
            gap: 20px;
            margin-top: 12px;
            font-size: 12px;
            color: var(--color-text-secondary);
            justify-content: center;
        }
        .chart-legend span {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .modal-footer {
            display: flex;
            justify-content: space-between;
            padding: 14px 24px;
            border-top: 1px solid var(--color-border);
            font-size: 12px;
            color: var(--color-text-muted);
            background: var(--color-bg-secondary);
        }

        /* ============================================================
           SCROLLBAR
           ============================================================ */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--color-bg-secondary); }
        ::-webkit-scrollbar-thumb { background: var(--color-border-dark); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #B0B8C1; }

        /* ============================================================
           FILTER BUTTON
           ============================================================ */
        .filter-row {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }
        .filter-btn {
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--color-border);
            background-color: var(--color-bg-primary);
            color: var(--color-text-secondary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        .filter-btn::before {
            content: '';
            width: 14px;
            height: 14px;
            border: 2px solid var(--color-border-dark);
            border-radius: 3px;
            transition: all 0.15s;
        }
        .filter-btn:hover {
            background-color: var(--color-bg-tertiary);
            border-color: var(--color-border-dark);
        }
        .filter-btn.active {
            background-color: var(--color-accent-light);
            border-color: var(--color-accent);
            color: var(--color-accent);
        }
        .filter-btn.active::before {
            background-color: var(--color-accent);
            border-color: var(--color-accent);
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z'/%3E%3C/svg%3E");
            background-size: 10px;
            background-repeat: no-repeat;
            background-position: center;
        }

        /* ============================================================
           PAGINATION - Yahoo Finance Style
           ============================================================ */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 4px;
            margin-top: 20px;
            padding: 16px;
            background: var(--color-bg-secondary);
            border-top: 1px solid var(--color-border);
            flex-wrap: wrap;
        }
        .pagination-btn {
            background: var(--color-bg-primary);
            border: 1px solid var(--color-border);
            color: var(--color-text-secondary);
            padding: 8px 12px;
            min-width: 36px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.15s;
        }
        .pagination-btn:hover:not(:disabled) {
            background: var(--color-bg-tertiary);
            border-color: var(--color-border-dark);
            color: var(--color-text-primary);
        }
        .pagination-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        .pagination-btn.active {
            background: var(--color-accent);
            border-color: var(--color-accent);
            color: white;
        }
        .pagination-info {
            color: var(--color-text-muted);
            font-size: 13px;
            margin: 0 12px;
        }
        .pagination-nav {
            display: flex;
            gap: 4px;
        }

        /* ============================================================
           RESPONSIVE DESIGN
           ============================================================ */
        @media (max-width: 768px) {
            .header-content { padding: 0 16px; height: 52px; }
            .logo { font-size: 16px; }
            .header-meta { display: none; }
            .container { padding: 16px; }
            .page-header { padding: 16px; }
            .page-header h1 { font-size: 18px; }
            th, td { padding: 10px 8px; font-size: 13px; }
            .screener-card { padding: 16px; }
            .home-header { padding: 32px 16px; }
            .home-header h1 { font-size: 24px; }
        }

        /* ============================================================
           UTILITY CLASSES
           ============================================================ */
        .nowrap { white-space: nowrap; }
        .font-mono { font-variant-numeric: tabular-nums; letter-spacing: 0.02em; }
    </style>
</head>
<body>
    <!-- Global Header -->
    <header class="global-header">
        <div class="header-content">
            <div class="logo" onclick="showPage('home')">
                <div class="logo-icon">S</div>
                <span>Stock Screener</span>
            </div>
            <div class="header-meta">
                <div class="update-badge">
                    ì‹¤ì‹œê°„ ë°ì´í„°
                </div>
                <span>KRX ê¸°ì¤€</span>
            </div>
        </div>
    </header>

    <!-- Home Page -->
    <div id="page-home" class="page active">
        <div class="container">
            <header class="home-header">
                <h1>ì£¼ì‹ ì¢…ëª© ë°œêµ´ ìŠ¤í¬ë¦¬ë„ˆ</h1>
                <p class="subtitle">ê¸°ìˆ ì  ë¶„ì„ ê¸°ë°˜ êµ­ë‚´ ì£¼ì‹ ìŠ¤í¬ë¦¬ë‹</p>
                <p class="meta">ì‹œê°€ì´ì•¡ 1,000ì–µ ì´ìƒ Â· 1,500+ ì¢…ëª© ë¶„ì„</p>
            </header>
            <main class="card-grid" id="home-cards"></main>
            <footer class="home-footer">
                <p>ë°ì´í„° ì¶œì²˜: KRX (í•œêµ­ê±°ë˜ì†Œ) Â· ë§¤ì¼ ì¥ ë§ˆê° í›„ ìë™ ì—…ë°ì´íŠ¸</p>
                <p class="disclaimer">ë³¸ ì„œë¹„ìŠ¤ëŠ” íˆ¬ì ì°¸ê³ ìš©ì´ë©°, íˆ¬ì íŒë‹¨ì˜ ì±…ì„ì€ ë³¸ì¸ì—ê²Œ ìˆìŠµë‹ˆë‹¤.</p>
            </footer>
        </div>
    </div>

    <!-- Box Range Page -->
    <div id="page-box-range" class="page">
        <div class="container">
            <a href="#" class="back-link" onclick="showPage('home'); return false;">â† í™ˆìœ¼ë¡œ</a>
            <header class="page-header">
                <div class="title-row">
                    <span class="icon">ğŸ“¦</span>
                    <h1>ë°•ìŠ¤ê¶Œ ìŠ¤í¬ë¦¬ë„ˆ</h1>
                    <span class="badge badge-info">í€€íŠ¸</span>
                </div>
                <p class="desc">60ê±°ë˜ì¼ ATRê¸°ë°˜ íš¡ë³´ + ì§€ì§€/ì €í•­ í„°ì¹˜ í™•ì¸ + ì¶”ì„¸ í•„í„° + ê±°ë˜ëŸ‰ ê°ì†Œ (7ì¡°ê±´)</p>
                <div class="filter-row" style="margin: 12px 0; display: flex; gap: 8px; align-items: center;">
                    <button id="filter-ma150-btn" class="filter-btn" onclick="toggleMA150Filter()">
                        150ì¼ì„  ìœ„ë§Œ
                    </button>
                </div>
                <div class="meta">
                    <span class="date" id="box-range-date">ë°ì´í„° ê¸°ì¤€: -</span>
                    <span><span class="count" id="box-range-count">-</span>ê°œ ì¢…ëª© <span class="total" id="box-range-total">/ 1,521ê°œ ì¤‘</span></span>
                </div>
            </header>
            <div class="card table-card">
                <div class="table-wrapper">
                    <table id="box-range-table"><thead></thead><tbody></tbody></table>
                </div>
                <div id="box-range-pagination" class="pagination"></div>
            </div>
        </div>
    </div>

    <!-- Box Breakout Page -->
    <div id="page-box-breakout" class="page">
        <div class="container">
            <a href="#" class="back-link" onclick="showPage('home'); return false;">â† í™ˆìœ¼ë¡œ</a>
            <header class="page-header">
                <div class="title-row">
                    <span class="icon">ğŸš€</span>
                    <h1>ë°•ìŠ¤ê¶Œ ëŒíŒŒ (ê±°ë˜ëŸ‰ ë™ë°˜)</h1>
                    <span class="badge badge-success">1ì°¨ ë§¤ìˆ˜</span>
                </div>
                <p class="desc">ê±°ë˜ëŸ‰ 2ë°° ë™ë°˜ ì €í•­ì„  ëŒíŒŒ</p>
                <div class="filter-row" style="margin: 12px 0; display: flex; gap: 8px; align-items: center;">
                    <button id="filter-ma150-box-breakout" class="filter-btn" onclick="toggleMA150Filter('boxBreakout')">
                        150ì¼ì„  ìœ„ë§Œ
                    </button>
                </div>
                <div class="meta">
                    <span class="date" id="box-breakout-date">ë°ì´í„° ê¸°ì¤€: -</span>
                    <span><span class="count" id="box-breakout-count">-</span>ê°œ ì¢…ëª© <span class="total">/ 1,521ê°œ ì¤‘</span></span>
                </div>
            </header>
            <div class="card table-card">
                <div class="table-wrapper">
                    <table id="box-breakout-table"><thead></thead><tbody></tbody></table>
                </div>
                <div id="box-breakout-pagination" class="pagination"></div>
            </div>
        </div>
    </div>

    <!-- Box Breakout Simple Page -->
    <div id="page-box-breakout-simple" class="page">
        <div class="container">
            <a href="#" class="back-link" onclick="showPage('home'); return false;">â† í™ˆìœ¼ë¡œ</a>
            <header class="page-header">
                <div class="title-row">
                    <span class="icon">ğŸ“ˆ</span>
                    <h1>ë°•ìŠ¤ê¶Œ ëŒíŒŒ (ê±°ë˜ëŸ‰ ë¬´ê´€)</h1>
                </div>
                <p class="desc">ê±°ë˜ëŸ‰ ë¬´ê´€ ëŒíŒŒ í›„ 10ì¼ ì´ë‚´</p>
                <div class="filter-row" style="margin: 12px 0; display: flex; gap: 8px; align-items: center;">
                    <button id="filter-ma150-box-breakout-simple" class="filter-btn" onclick="toggleMA150Filter('boxBreakoutSimple')">
                        150ì¼ì„  ìœ„ë§Œ
                    </button>
                </div>
                <div class="meta">
                    <span class="date" id="box-breakout-simple-date">ë°ì´í„° ê¸°ì¤€: -</span>
                    <span><span class="count" id="box-breakout-simple-count">-</span>ê°œ ì¢…ëª© <span class="total">/ 1,521ê°œ ì¤‘</span></span>
                </div>
            </header>
            <div class="card table-card">
                <div class="table-wrapper">
                    <table id="box-breakout-simple-table"><thead></thead><tbody></tbody></table>
                </div>
                <div id="box-breakout-simple-pagination" class="pagination"></div>
            </div>
        </div>
    </div>

    <!-- Pullback Page -->
    <div id="page-pullback" class="page">
        <div class="container">
            <a href="#" class="back-link" onclick="showPage('home'); return false;">â† í™ˆìœ¼ë¡œ</a>
            <header class="page-header">
                <div class="title-row">
                    <span class="icon">ğŸ¯</span>
                    <h1>í’€ë°± ìŠ¤í¬ë¦¬ë„ˆ</h1>
                    <span class="badge badge-success">2ì°¨ ë§¤ìˆ˜</span>
                </div>
                <p class="desc">ëŒíŒŒ í›„ ì €í•­ì„  Â±5% ì´ë‚´ ë˜ëŒë¦¼ ì¢…ëª©</p>
                <div class="filter-row" style="margin: 12px 0; display: flex; gap: 8px; align-items: center;">
                    <button id="filter-ma150-pullback" class="filter-btn" onclick="toggleMA150Filter('pullback')">
                        150ì¼ì„  ìœ„ë§Œ
                    </button>
                </div>
                <div class="meta">
                    <span class="date" id="pullback-date">ë°ì´í„° ê¸°ì¤€: -</span>
                    <span><span class="count" id="pullback-count">-</span>ê°œ ì¢…ëª© <span class="total">/ 1,521ê°œ ì¤‘</span></span>
                </div>
            </header>
            <div class="card table-card">
                <div class="table-wrapper">
                    <table id="pullback-table"><thead></thead><tbody></tbody></table>
                </div>
                <div id="pullback-pagination" class="pagination"></div>
            </div>
        </div>
    </div>

    <!-- Volume Dry Up Page -->
    <div id="page-volume-dry-up" class="page">
        <div class="container">
            <a href="#" class="back-link" onclick="showPage('home'); return false;">â† í™ˆìœ¼ë¡œ</a>
            <header class="page-header">
                <div class="title-row">
                    <span class="icon">ğŸœï¸</span>
                    <h1>ê±°ë˜ëŸ‰ ê¸‰ê° ëˆŒë¦¼ëª©</h1>
                    <span class="badge badge-warning">ì„¸ë ¥ ë³´ìœ </span>
                </div>
                <p class="desc">20ì¼ í‰ê·  3ë°° ê±°ë˜ëŸ‰ + 8% ì¥ëŒ€ì–‘ë´‰ í›„ 10ì¼ ì´ë‚´ ê±°ë˜ëŸ‰ ê³ ê°ˆ</p>
                <div class="filter-row" style="margin: 12px 0; display: flex; gap: 8px; align-items: center;">
                    <button id="filter-ma150-volume-dry-up" class="filter-btn" onclick="toggleMA150Filter('volumeDryUp')">
                        150ì¼ì„  ìœ„ë§Œ
                    </button>
                </div>
                <div class="meta">
                    <span class="date" id="volume-dry-up-date">ë°ì´í„° ê¸°ì¤€: -</span>
                    <span><span class="count" id="volume-dry-up-count">-</span>ê°œ ì¢…ëª© <span class="total">/ 1,521ê°œ ì¤‘</span></span>
                </div>
            </header>
            <div class="card table-card">
                <div class="table-wrapper">
                    <table id="volume-dry-up-table"><thead></thead><tbody></tbody></table>
                </div>
                <div id="volume-dry-up-pagination" class="pagination"></div>
            </div>
        </div>
    </div>

    <!-- Volume Explosion Page -->
    <div id="page-volume-explosion" class="page">
        <div class="container">
            <a href="#" class="back-link" onclick="showPage('home'); return false;">â† í™ˆìœ¼ë¡œ</a>
            <header class="page-header">
                <div class="title-row">
                    <span class="icon">ğŸ’¥</span>
                    <h1>ê±°ë˜ëŸ‰ í­ë°œ</h1>
                    <span class="badge badge-danger">ë‹¹ì¼</span>
                </div>
                <p class="desc">40ì¼ í‰ê·  ê±°ë˜ëŸ‰ 6ë°° + 6% ì´ìƒ ì¥ëŒ€ì–‘ë´‰</p>
                <div class="filter-row" style="margin: 12px 0; display: flex; gap: 8px; align-items: center;">
                    <button id="filter-ma150-volume-explosion" class="filter-btn" onclick="toggleMA150Filter('volumeExplosion')">
                        150ì¼ì„  ìœ„ë§Œ
                    </button>
                </div>
                <div class="meta">
                    <span class="date" id="volume-explosion-date">ë°ì´í„° ê¸°ì¤€: -</span>
                    <span><span class="count" id="volume-explosion-count">-</span>ê°œ ì¢…ëª© <span class="total">/ 1,521ê°œ ì¤‘</span></span>
                </div>
            </header>
            <div class="card table-card">
                <div class="table-wrapper">
                    <table id="volume-explosion-table"><thead></thead><tbody></tbody></table>
                </div>
                <div id="volume-explosion-pagination" class="pagination"></div>
            </div>
        </div>
    </div>

    <!-- 52-Week High Page -->
    <div id="page-new-high-52w" class="page">
        <div class="container">
            <a href="#" class="back-link" onclick="showPage('home'); return false;">â† í™ˆìœ¼ë¡œ</a>
            <header class="page-header">
                <div class="title-row">
                    <span class="icon">ğŸ”ï¸</span>
                    <h1>52ì£¼ ì‹ ê³ ê°€ ëŒíŒŒ</h1>
                    <span class="badge badge-success">ì‹ ê³ ê°€</span>
                </div>
                <p class="desc">52ì£¼ ì‹ ê³ ê°€ ëŒíŒŒ í›„ 8ê±°ë˜ì¼ ì´ë‚´ ì¢…ëª©</p>
                <div class="meta">
                    <span class="date" id="new-high-52w-date">ë°ì´í„° ê¸°ì¤€: -</span>
                    <span><span class="count" id="new-high-52w-count">-</span>ê°œ ì¢…ëª© <span class="total">/ 1,521ê°œ ì¤‘</span></span>
                </div>
            </header>
            <div class="card table-card">
                <div class="table-wrapper">
                    <table id="new-high-52w-table"><thead></thead><tbody></tbody></table>
                </div>
                <div id="new-high-52w-pagination" class="pagination"></div>
            </div>
        </div>
    </div>

    <!-- Sector Stage Page -->
    <div id="page-sector-stage" class="page">
        <div class="container">
            <a href="#" class="back-link" onclick="showPage('home'); return false;">â† í™ˆìœ¼ë¡œ</a>
            <header class="page-header">
                <div class="title-row">
                    <span class="icon">ğŸ­</span>
                    <h1>ì—…ì¢…ë³„ 4ë‹¨ê³„</h1>
                </div>
                <p class="desc">Weinstein 4ë‹¨ê³„ ì—…ì¢… ë¶„ì„</p>
                <div class="meta">
                    <span class="date" id="sector-stage-date">ë°ì´í„° ê¸°ì¤€: -</span>
                    <span><span class="count" id="sector-stage-count">-</span>ê°œ ì—…ì¢…</span>
                </div>
            </header>
            <div class="stage-grid">
                <div class="card stage-info"><div class="emoji">1ï¸âƒ£</div><div class="name" style="color: var(--color-text-primary)">ê¸°ì´ˆ</div><div class="sub">íš¡ë³´ êµ¬ê°„</div></div>
                <div class="card stage-info"><div class="emoji">2ï¸âƒ£</div><div class="name stage-2">ìƒìŠ¹</div><div class="sub">ë§¤ìˆ˜ ì ê¸°</div></div>
                <div class="card stage-info"><div class="emoji">3ï¸âƒ£</div><div class="name stage-3">ìµœì •ìƒ</div><div class="sub">ë§¤ë„ ì¤€ë¹„</div></div>
                <div class="card stage-info"><div class="emoji">4ï¸âƒ£</div><div class="name stage-4">ì‡ í‡´</div><div class="sub">ë§¤ë„/ê´€ë§</div></div>
            </div>
            <div id="sector-stage-content"></div>
        </div>
    </div>

    <!-- Chart Modal -->
    <div id="chart-modal" class="modal-overlay" onclick="if(event.target===this)closeModal()">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-stock-info">
                    <div><span id="modal-name"></span><span id="modal-ticker" class="ticker"></span></div>
                    <div class="price-row">
                        <span id="modal-price" class="price"></span>
                        <span id="modal-change"></span>
                    </div>
                </div>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="chart-container" class="chart-container">
                    <div id="chart-loading" class="chart-loading">ì°¨íŠ¸ ë¡œë”© ì¤‘...</div>
                </div>
                <div class="chart-legend">
                    <span><span style="color:#FF69B4">â—</span> 5ì¼ì„ </span>
                    <span><span style="color:#4A90E2">â—</span> 20ì¼ì„ </span>
                    <span><span style="color:#E74C3C">â—</span> 40ì¼ì„ </span>
                    <span><span style="color:#95A5A6">â—</span> 150ì¼ì„ </span>
                </div>
            </div>
            <div class="modal-footer">
                <span>ë°ì´í„°: KRX (í•œêµ­ê±°ë˜ì†Œ) Â· ìˆ˜ì •ì£¼ê°€ ê¸°ì¤€</span>
                <span>ESC ë˜ëŠ” ë°”ê¹¥ ì˜ì—­ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°</span>
            </div>
        </div>
    </div>

    <!-- Lightweight Charts CDN -->
    <script src="https://unpkg.com/lightweight-charts@5.0.0/dist/lightweight-charts.standalone.production.js"></script>

    <script>
        // ============================================================
        // ë™ì  ë°ì´í„° ë¡œë”© ì‹œìŠ¤í…œ
        // GitHub Pagesì—ì„œ ì™¸ë¶€ JSON íŒŒì¼ ë¡œë“œ
        // ============================================================

        // ë¹ˆ DATA ê°ì²´ - ë¡œë“œ ì‹œ ì±„ì›Œì§
        let DATA = {
            boxRange: { meta: { lastUpdated: null, totalCount: 0 }, data: [] },
            boxBreakout: { meta: { lastUpdated: null, totalCount: 0 }, data: [] },
            boxBreakoutSimple: { meta: { lastUpdated: null, totalCount: 0 }, data: [] },
            pullback: { meta: { lastUpdated: null, totalCount: 0 }, data: [] },
            volumeDryUp: { meta: { lastUpdated: null, totalCount: 0 }, data: [] },
            volumeExplosion: { meta: { lastUpdated: null, totalCount: 0 }, data: [] },
            newHigh52w: { meta: { lastUpdated: null, totalCount: 0 }, data: [] },
            sectorStage: { meta: { lastUpdated: null, totalCount: 0 }, data: [] }
        };

        // ë°ì´í„° ë¡œë”© ìƒíƒœ
        let dataLoaded = false;
        let dataLoadError = null;

        // JSON íŒŒì¼ ë§¤í•‘
        const DATA_FILES = {
            boxRange: 'box_range.json',
            boxBreakout: 'box_breakout.json',
            boxBreakoutSimple: 'box_breakout_simple.json',
            pullback: 'pullback.json',
            volumeDryUp: 'volume_dry_up.json',
            volumeExplosion: 'volume_explosion.json',
            newHigh52w: 'new_high_52w.json',
            sectorStage: 'sector_stage.json'
        };

        // ë°ì´í„° ê²½ë¡œ í›„ë³´ (GitHub Pages, ë¡œì»¬ ë“± ë‹¤ì–‘í•œ í™˜ê²½ ì§€ì›)
        const DATA_PATH_CANDIDATES = [
            './data/',           // GitHub Pages ê¸°ë³¸ ê²½ë¡œ
            'data/',             // ìƒëŒ€ ê²½ë¡œ
            '../data/',          // ìƒìœ„ í´ë”
            '/stock-screener-kr/data/',  // GitHub Pages repo ê²½ë¡œ
            'web/public/data/'   // ë¡œì»¬ ê°œë°œ ê²½ë¡œ
        ];

        // ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
        async function loadAllData() {
            console.log('ğŸ“Š ìŠ¤í¬ë¦¬ë„ˆ ë°ì´í„° ë¡œë”© ì‹œì‘...');

            // ë¡œë”© UI í‘œì‹œ
            showLoadingState();

            // ì‘ë™í•˜ëŠ” ê²½ë¡œ ì°¾ê¸°
            let workingPath = null;

            for (const basePath of DATA_PATH_CANDIDATES) {
                try {
                    const testUrl = basePath + 'box_range.json';
                    const res = await fetch(testUrl);
                    if (res.ok) {
                        workingPath = basePath;
                        console.log(`âœ… ë°ì´í„° ê²½ë¡œ ë°œê²¬: ${basePath}`);
                        break;
                    }
                } catch (e) {
                    // ë‹¤ìŒ ê²½ë¡œ ì‹œë„
                }
            }

            if (!workingPath) {
                console.error('âŒ ë°ì´í„° íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                dataLoadError = 'ë°ì´í„° íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìŠ¤í¬ë¦¬ë„ˆë¥¼ ë¨¼ì € ì‹¤í–‰í•´ì£¼ì„¸ìš”.';
                showErrorState(dataLoadError);
                return false;
            }

            // ëª¨ë“  ë°ì´í„° íŒŒì¼ ë³‘ë ¬ ë¡œë“œ
            const loadPromises = Object.entries(DATA_FILES).map(async ([key, filename]) => {
                try {
                    const res = await fetch(workingPath + filename);
                    if (res.ok) {
                        const json = await res.json();
                        DATA[key] = json;
                        console.log(`  âœ“ ${key}: ${json.data?.length || 0}ê°œ ì¢…ëª©`);
                    } else {
                        console.warn(`  âš  ${key}: íŒŒì¼ ì—†ìŒ (${filename})`);
                    }
                } catch (e) {
                    console.warn(`  âš  ${key}: ë¡œë“œ ì‹¤íŒ¨ - ${e.message}`);
                }
            });

            await Promise.all(loadPromises);

            dataLoaded = true;
            console.log('âœ… ë°ì´í„° ë¡œë”© ì™„ë£Œ');

            return true;
        }

        // ë¡œë”© ìƒíƒœ UI
        function showLoadingState() {
            const mainContent = document.querySelector('.main-content');
            if (mainContent) {
                const loadingDiv = document.createElement('div');
                loadingDiv.id = 'data-loading-indicator';
                loadingDiv.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:40px 60px;border-radius:16px;box-shadow:0 8px 32px rgba(0,0,0,0.15);z-index:9999;text-align:center;';
                loadingDiv.innerHTML = `
                    <div style="width:48px;height:48px;border:4px solid #E5E8EB;border-top-color:#0066CC;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 20px;"></div>
                    <div style="font-size:18px;font-weight:600;color:#1E2329;margin-bottom:8px;">ë°ì´í„° ë¡œë”© ì¤‘...</div>
                    <div style="font-size:14px;color:#8B95A1;">ìŠ¤í¬ë¦¬ë„ˆ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤</div>
                `;
                document.body.appendChild(loadingDiv);
            }
        }

        function hideLoadingState() {
            const loading = document.getElementById('data-loading-indicator');
            if (loading) loading.remove();
        }

        function showErrorState(message) {
            hideLoadingState();
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:40px 60px;border-radius:16px;box-shadow:0 8px 32px rgba(0,0,0,0.15);z-index:9999;text-align:center;max-width:400px;';
            errorDiv.innerHTML = `
                <div style="font-size:48px;margin-bottom:16px;">âš ï¸</div>
                <div style="font-size:18px;font-weight:600;color:#1E2329;margin-bottom:12px;">ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</div>
                <div style="font-size:14px;color:#5E6673;line-height:1.6;">${message}</div>
                <button onclick="location.reload()" style="margin-top:20px;padding:10px 24px;background:#0066CC;color:white;border:none;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;">ìƒˆë¡œê³ ì¹¨</button>
            `;
            document.body.appendChild(errorDiv);
        }

        // ìŠ¤í”¼ë„ˆ ì• ë‹ˆë©”ì´ì…˜ ìŠ¤íƒ€ì¼ ì¶”ê°€
        const spinStyle = document.createElement('style');
        spinStyle.textContent = '@keyframes spin { to { transform: rotate(360deg); } }';
        document.head.appendChild(spinStyle);

        // ============================================================
        // ê¸°ì¡´ ë°ì´í„° êµ¬ì¡° (ì´ì œ ë™ì ìœ¼ë¡œ ë¡œë“œë¨)
        // ì•„ë˜ ì£¼ì„ì€ ì›ë³¸ ì¸ë¼ì¸ ë°ì´í„°ê°€ ìˆë˜ ìë¦¬ì…ë‹ˆë‹¤
        // ============================================================

        // ì¸ë¼ì¸ ë°ì´í„° ì œê±°ë¨ - ì™¸ë¶€ JSON íŒŒì¼ì—ì„œ ë¡œë“œí•©ë‹ˆë‹¤
        // ë°ì´í„° ë¡œë”©ì€ loadAllData() í•¨ìˆ˜ì—ì„œ ì²˜ë¦¬

        const screeners = [
            { id: 'box-range', icon: 'ğŸ“¦', title: 'ë°•ìŠ¤ê¶Œ ìŠ¤í¬ë¦¬ë„ˆ', desc: '60ê±°ë˜ì¼ ì´ìƒ íš¡ë³´ ì¤‘ì¸ ì¢…ëª©', badge: { text: 'ê¸°ì´ˆ', type: 'info' } },
            { id: 'box-breakout', icon: 'ğŸš€', title: 'ë°•ìŠ¤ê¶Œ ëŒíŒŒ (ê±°ë˜ëŸ‰ ë™ë°˜)', desc: 'ê±°ë˜ëŸ‰ 2ë°° ë™ë°˜ ì €í•­ì„  ëŒíŒŒ', badge: { text: '1ì°¨ ë§¤ìˆ˜', type: 'success' } },
            { id: 'box-breakout-simple', icon: 'ğŸ“ˆ', title: 'ë°•ìŠ¤ê¶Œ ëŒíŒŒ (ê±°ë˜ëŸ‰ ë¬´ê´€)', desc: 'ê±°ë˜ëŸ‰ ë¬´ê´€ ëŒíŒŒ í›„ 10ì¼ ì´ë‚´' },
            { id: 'pullback', icon: 'ğŸ¯', title: 'í’€ë°± ìŠ¤í¬ë¦¬ë„ˆ', desc: 'ëŒíŒŒ í›„ ë˜ëŒë¦¼ ì¢…ëª©', badge: { text: '2ì°¨ ë§¤ìˆ˜', type: 'success' } },
            { id: 'volume-dry-up', icon: 'ğŸœï¸', title: 'ê±°ë˜ëŸ‰ ê¸‰ê° ëˆŒë¦¼ëª©', desc: '3ë°° ê±°ë˜ëŸ‰+8% ì–‘ë´‰ í›„ 10ì¼ë‚´', badge: { text: 'ì„¸ë ¥ ë³´ìœ ', type: 'warning' } },
            { id: 'volume-explosion', icon: 'ğŸ’¥', title: 'ê±°ë˜ëŸ‰ í­ë°œ', desc: '40ì¼ í‰ê·  6ë°°+6% ì–‘ë´‰', badge: { text: 'ë‹¹ì¼', type: 'danger' } },
            { id: 'new-high-52w', icon: 'ğŸ”ï¸', title: '52ì£¼ ì‹ ê³ ê°€ ëŒíŒŒ', desc: 'ì‹ ê³ ê°€ ëŒíŒŒ í›„ 8ê±°ë˜ì¼ ì´ë‚´', badge: { text: 'ì‹ ê³ ê°€', type: 'success' } },
            { id: 'sector-stage', icon: 'ğŸ­', title: 'ì—…ì¢…ë³„ 4ë‹¨ê³„', desc: 'ì—…ì¢… ì¶”ì„¸ ë¶„ì„' }
        ];

        // Utils
        const formatNumber = n => n.toLocaleString('ko-KR');
        const formatPercent = n => (n >= 0 ? '+' : '') + n.toFixed(2) + '%';
        const getColor = n => n > 0 ? 'positive' : n < 0 ? 'negative' : 'neutral';
        const formatShortDate = d => { const date = new Date(d); return (date.getMonth()+1) + 'ì›” ' + date.getDate() + 'ì¼'; };
        const formatMarketCap = cap => { if (!cap) return '-'; if (cap >= 10000) return (cap / 10000).toFixed(1) + 'ì¡°'; return formatNumber(cap) + 'ì–µ'; };

        // Chart data cache
        let chartDataCache = null;
        let chartInstance = null;

        // Load chart data
        async function loadChartData() {
            if (chartDataCache) return chartDataCache;
            try {
                // Try loading from various paths (GitHub Pages, local dev)
                const paths = [
                    './data/chart_data.json',
                    'data/chart_data.json',
                    '/stock-screener-kr/data/chart_data.json',
                    'chart_data.json',
                    './chart_data.json',
                    'web/public/data/chart_data.json'
                ];
                for (const path of paths) {
                    try {
                        const res = await fetch(path);
                        if (res.ok) {
                            chartDataCache = await res.json();
                            console.log(`âœ“ ì°¨íŠ¸ ë°ì´í„° ë¡œë“œ: ${path}`);
                            return chartDataCache;
                        }
                    } catch (e) { /* try next */ }
                }
                console.warn('âš  ì°¨íŠ¸ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return null;
            } catch (e) {
                console.error('Chart data load error:', e);
                return null;
            }
        }

        // Sort state for each table
        const sortState = {};

        // Filter state for each screener
        const filterMA150State = {
            boxRange: false,
            boxBreakout: false,
            boxBreakoutSimple: false,
            pullback: false,
            volumeDryUp: false,
            volumeExplosion: false
        };

        // Pagination state
        const ITEMS_PER_PAGE = 30;
        const paginationState = {
            boxRange: 1,
            boxBreakout: 1,
            boxBreakoutSimple: 1,
            pullback: 1,
            volumeDryUp: 1,
            volumeExplosion: 1,
            newHigh52w: 1
        };

        // Pagination helper functions
        function paginate(data, page) {
            const start = (page - 1) * ITEMS_PER_PAGE;
            const end = start + ITEMS_PER_PAGE;
            return data.slice(start, end);
        }

        function getTotalPages(totalItems) {
            return Math.ceil(totalItems / ITEMS_PER_PAGE);
        }

        function goToPage(screenerId, page, renderFn) {
            paginationState[screenerId] = page;
            renderFn();
        }

        function renderPagination(containerId, screenerId, totalItems, renderFn) {
            const container = document.getElementById(containerId);
            if (!container) return;

            const totalPages = getTotalPages(totalItems);
            const currentPage = paginationState[screenerId];

            if (totalPages <= 1) {
                container.innerHTML = '';
                return;
            }

            let html = '';

            // Previous button
            html += `<button class="pagination-btn" ${currentPage === 1 ? 'disabled' : ''}
                onclick="goToPage('${screenerId}', ${currentPage - 1}, ${renderFn.name})">â—€ ì´ì „</button>`;

            // Page numbers
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

            if (endPage - startPage < maxVisiblePages - 1) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }

            if (startPage > 1) {
                html += `<button class="pagination-btn" onclick="goToPage('${screenerId}', 1, ${renderFn.name})">1</button>`;
                if (startPage > 2) html += `<span class="pagination-info">...</span>`;
            }

            for (let i = startPage; i <= endPage; i++) {
                html += `<button class="pagination-btn ${i === currentPage ? 'active' : ''}"
                    onclick="goToPage('${screenerId}', ${i}, ${renderFn.name})">${i}</button>`;
            }

            if (endPage < totalPages) {
                if (endPage < totalPages - 1) html += `<span class="pagination-info">...</span>`;
                html += `<button class="pagination-btn" onclick="goToPage('${screenerId}', ${totalPages}, ${renderFn.name})">${totalPages}</button>`;
            }

            // Next button
            html += `<button class="pagination-btn" ${currentPage === totalPages ? 'disabled' : ''}
                onclick="goToPage('${screenerId}', ${currentPage + 1}, ${renderFn.name})">ë‹¤ìŒ â–¶</button>`;

            // Page info
            const startItem = (currentPage - 1) * ITEMS_PER_PAGE + 1;
            const endItem = Math.min(currentPage * ITEMS_PER_PAGE, totalItems);
            html += `<span class="pagination-info">${startItem}-${endItem} / ${totalItems}ê°œ</span>`;

            container.innerHTML = html;
        }

        // Button ID mapping
        const filterBtnIds = {
            boxRange: 'filter-ma150-btn',
            boxBreakout: 'filter-ma150-box-breakout',
            boxBreakoutSimple: 'filter-ma150-box-breakout-simple',
            pullback: 'filter-ma150-pullback',
            volumeDryUp: 'filter-ma150-volume-dry-up',
            volumeExplosion: 'filter-ma150-volume-explosion'
        };

        // Render function mapping
        const renderFunctions = {
            boxRange: () => renderBoxRange(),
            boxBreakout: () => renderBoxBreakout(),
            boxBreakoutSimple: () => renderBoxBreakoutSimple(),
            pullback: () => renderPullback(),
            volumeDryUp: () => renderVolumeDryUp(),
            volumeExplosion: () => renderVolumeExplosion(),
            newHigh52w: () => renderNewHigh52w()
        };

        // Toggle MA150 filter for specific screener
        function toggleMA150Filter(screener = 'boxRange') {
            filterMA150State[screener] = !filterMA150State[screener];
            paginationState[screener] = 1; // Reset pagination when filter changes
            const btn = document.getElementById(filterBtnIds[screener]);
            if (btn) {
                btn.classList.toggle('active', filterMA150State[screener]);
            }
            renderFunctions[screener]();
        }

        // Sort data
        function sortData(data, key, direction) {
            if (!key || !direction) return data;
            return [...data].sort((a, b) => {
                const aVal = a[key];
                const bVal = b[key];
                if (aVal == null && bVal == null) return 0;
                if (aVal == null) return 1;
                if (bVal == null) return -1;
                if (typeof aVal === 'number' && typeof bVal === 'number') {
                    return direction === 'asc' ? aVal - bVal : bVal - aVal;
                }
                const aStr = String(aVal), bStr = String(bVal);
                return direction === 'asc' ? aStr.localeCompare(bStr, 'ko') : bStr.localeCompare(aStr, 'ko');
            });
        }

        // Get sort icon
        function getSortIcon(tableId, key) {
            const state = sortState[tableId];
            if (!state || state.key !== key) return 'â‡…';
            return state.direction === 'asc' ? 'â–²' : 'â–¼';
        }

        // Handle sort click
        // Map tableId to screenerId for pagination reset
        const tableToScreener = {
            'box-range-table': 'boxRange',
            'box-breakout-table': 'boxBreakout',
            'box-breakout-simple-table': 'boxBreakoutSimple',
            'pullback-table': 'pullback',
            'volume-dry-up-table': 'volumeDryUp',
            'volume-explosion-table': 'volumeExplosion',
            'new-high-52w-table': 'newHigh52w'
        };

        function handleSort(tableId, key, renderFn) {
            const state = sortState[tableId] || { key: null, direction: null };
            if (state.key === key) {
                if (state.direction === 'asc') state.direction = 'desc';
                else if (state.direction === 'desc') { state.key = null; state.direction = null; }
                else state.direction = 'asc';
            } else {
                state.key = key;
                state.direction = 'asc';
            }
            sortState[tableId] = state;
            // Reset pagination when sort changes
            const screenerId = tableToScreener[tableId];
            if (screenerId) paginationState[screenerId] = 1;
            renderFn();
        }

        // Open chart modal
        async function openChartModal(stock) {
            const modal = document.getElementById('chart-modal');
            document.getElementById('modal-name').textContent = stock.name;
            document.getElementById('modal-ticker').textContent = stock.ticker;
            document.getElementById('modal-price').textContent = formatNumber(stock.price) + 'ì›';
            const changeEl = document.getElementById('modal-change');
            changeEl.textContent = formatPercent(stock.change_rate);
            changeEl.className = getColor(stock.change_rate);

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';

            const container = document.getElementById('chart-container');
            container.innerHTML = '<div class="chart-loading">ì°¨íŠ¸ ë¡œë”© ì¤‘...</div>';

            if (chartInstance) {
                chartInstance.remove();
                chartInstance = null;
            }

            // Load and render chart
            const chartData = await loadChartData();
            const stockData = chartData ? chartData[stock.ticker] : null;

            if (!stockData || stockData.length === 0) {
                container.innerHTML = '<div class="chart-loading">ì°¨íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤<br><small style="margin-top:8px;display:block;color:#8B95A1">í•´ë‹¹ ì¢…ëª©ì˜ ê³¼ê±° ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</small></div>';
                return;
            }

            // Create chart - Light theme
            container.innerHTML = '';
            chartInstance = LightweightCharts.createChart(container, {
                width: container.clientWidth,
                height: 400,
                layout: { background: { type: 'solid', color: '#FAFBFC' }, textColor: '#5E6673' },
                grid: { vertLines: { color: '#E5E8EB' }, horzLines: { color: '#E5E8EB' } },
                crosshair: { mode: 1 },
                rightPriceScale: { borderColor: '#E5E8EB' },
                timeScale: { borderColor: '#E5E8EB', timeVisible: false }
            });

            // Candlestick (v5 API) - Korean style: Red up, Blue down
            const candleSeries = chartInstance.addSeries(LightweightCharts.CandlestickSeries, {
                upColor: '#E31B1B', downColor: '#1261C4',
                borderUpColor: '#E31B1B', borderDownColor: '#1261C4',
                wickUpColor: '#E31B1B', wickDownColor: '#1261C4'
            });
            candleSeries.setData(stockData.map(d => ({
                time: d.date, open: d.open, high: d.high, low: d.low, close: d.close
            })));

            // Moving averages
            const maColors = { 5: '#FF69B4', 20: '#4A90E2', 40: '#E74C3C', 150: '#95A5A6' };
            [5, 20, 40, 150].forEach(period => {
                if (stockData.length >= period) {
                    const maData = [];
                    for (let i = period - 1; i < stockData.length; i++) {
                        let sum = 0;
                        for (let j = 0; j < period; j++) sum += stockData[i - j].close;
                        maData.push({ time: stockData[i].date, value: sum / period });
                    }
                    const maSeries = chartInstance.addSeries(LightweightCharts.LineSeries, {
                        color: maColors[period], lineWidth: 1, priceLineVisible: false, lastValueVisible: false
                    });
                    maSeries.setData(maData);
                }
            });

            // Volume (v5 API) - Korean style colors
            const volumeSeries = chartInstance.addSeries(LightweightCharts.HistogramSeries, {
                color: 'rgba(139, 149, 161, 0.4)', priceFormat: { type: 'volume' }, priceScaleId: ''
            });
            volumeSeries.priceScale().applyOptions({ scaleMargins: { top: 0.8, bottom: 0 } });
            volumeSeries.setData(stockData.map((d, i) => ({
                time: d.date, value: d.volume,
                color: i === 0 ? 'rgba(139, 149, 161, 0.4)' :
                       d.close >= stockData[i-1].close ? 'rgba(227, 27, 27, 0.4)' : 'rgba(18, 97, 196, 0.4)'
            })));

            chartInstance.timeScale().fitContent();

            // Resize handler
            const resizeHandler = () => {
                if (chartInstance) chartInstance.applyOptions({ width: container.clientWidth });
            };
            window.addEventListener('resize', resizeHandler);
            chartInstance._resizeHandler = resizeHandler;
        }

        // Close modal
        function closeModal() {
            const modal = document.getElementById('chart-modal');
            modal.classList.remove('active');
            document.body.style.overflow = '';
            if (chartInstance) {
                if (chartInstance._resizeHandler) window.removeEventListener('resize', chartInstance._resizeHandler);
                chartInstance.remove();
                chartInstance = null;
            }
        }

        // ESC key handler
        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

        // Date formatting function
        function formatDateFromISO(isoString) {
            if (!isoString) return '-';
            try {
                const date = new Date(isoString);
                const year = date.getFullYear();
                const month = date.getMonth() + 1;
                const day = date.getDate();
                return `${year}ë…„ ${month}ì›” ${day}ì¼`;
            } catch {
                return '-';
            }
        }

        // Update all page dates from meta.lastUpdated
        function updatePageDates() {
            const dateMapping = {
                'box-range-date': DATA.boxRange?.meta?.lastUpdated,
                'box-breakout-date': DATA.boxBreakout?.meta?.lastUpdated,
                'box-breakout-simple-date': DATA.boxBreakoutSimple?.meta?.lastUpdated,
                'pullback-date': DATA.pullback?.meta?.lastUpdated,
                'volume-dry-up-date': DATA.volumeDryUp?.meta?.lastUpdated,
                'volume-explosion-date': DATA.volumeExplosion?.meta?.lastUpdated,
                'new-high-52w-date': DATA.newHigh52w?.meta?.lastUpdated,
                'sector-stage-date': DATA.sectorStage?.meta?.lastUpdated
            };

            for (const [elementId, lastUpdated] of Object.entries(dateMapping)) {
                const el = document.getElementById(elementId);
                if (el) {
                    el.textContent = `ë°ì´í„° ê¸°ì¤€: ${formatDateFromISO(lastUpdated)}`;
                }
            }
        }

        // Home
        function renderHome() {
            // Get stock counts for each screener
            const stockCounts = {
                'box-range': DATA.boxRange?.meta?.totalCount || 0,
                'box-breakout': DATA.boxBreakout?.meta?.totalCount || 0,
                'box-breakout-simple': DATA.boxBreakoutSimple?.meta?.totalCount || 0,
                'pullback': DATA.pullback?.meta?.totalCount || 0,
                'volume-dry-up': DATA.volumeDryUp?.meta?.totalCount || 0,
                'volume-explosion': DATA.volumeExplosion?.meta?.totalCount || 0,
                'new-high-52w': DATA.newHigh52w?.meta?.totalCount || 0,
                'sector-stage': DATA.sectorStage?.meta?.totalCount || 0
            };

            document.getElementById('home-cards').innerHTML = screeners.map(s => `
                <div class="card screener-card" onclick="showPage('${s.id}')">
                    <div class="content">
                        <div class="icon">${s.icon}</div>
                        <div class="info">
                            <div class="title-row">
                                <h2>${s.title}</h2>
                                ${s.badge ? `<span class="badge badge-${s.badge.type}">${s.badge.text}</span>` : ''}
                            </div>
                            <p class="desc">${s.desc}</p>
                            <div class="stock-count">
                                ${stockCounts[s.id] > 0 ? `<strong>${stockCounts[s.id]}</strong>ê°œ ì¢…ëª© ë°œêµ´` : 'ë°ì´í„° ë¡œë”© ì¤‘...'}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Tables with sorting
        function renderTable(tableId, headers, rows, renderFn) {
            const table = document.getElementById(tableId);
            const state = sortState[tableId] || {};
            table.querySelector('thead').innerHTML = '<tr>' + headers.map(h =>
                `<th class="${h.align || ''} ${state.key === h.key ? 'sorted' : ''}"
                    ${h.key ? `onclick="handleSort('${tableId}', '${h.key}', ${renderFn.name})"` : ''}>
                    ${h.label}${h.key ? `<span class="sort-icon">${getSortIcon(tableId, h.key)}</span>` : ''}
                </th>`
            ).join('') + '</tr>';
            table.querySelector('tbody').innerHTML = rows;
        }

        function renderBoxRange() {
            // í•„í„° ì ìš©
            let filteredData = DATA.boxRange.data;
            if (filterMA150State.boxRange) {
                filteredData = filteredData.filter(s => s.above_ma150 === true);
            }

            // ì¹´ìš´íŠ¸ í‘œì‹œ
            const countEl = document.getElementById('box-range-count');
            countEl.textContent = filteredData.length;

            const headers = [
                { label: 'ì¢…ëª©ëª…', key: 'name' }, { label: 'í˜„ì¬ê°€', align: 'text-right', key: 'price' },
                { label: 'ë“±ë½ë¥ ', align: 'text-right', key: 'change_rate' },
                { label: 'ì‹œê°€ì´ì•¡', align: 'text-right', key: 'market_cap' },
                { label: 'ë°•ìŠ¤ ìƒë‹¨', align: 'text-right', key: 'box_high' }, { label: 'ë°•ìŠ¤ í•˜ë‹¨', align: 'text-right', key: 'box_low' },
                { label: 'ë³€ë™í­', align: 'text-right', key: 'range_percent' }, { label: 'ì§€ì§€ í„°ì¹˜', align: 'text-center', key: 'support_touches' },
                { label: 'ATRë°°ìˆ˜', align: 'text-right', key: 'atr_multiple' }, { label: 'íš¡ë³´ ê¸°ê°„', align: 'text-right', key: 'days' }
            ];
            const state = sortState['box-range-table'] || {};
            const sortedData = sortData(filteredData, state.key, state.direction);
            const paginatedData = paginate(sortedData, paginationState.boxRange);
            const rows = paginatedData.map(s => `
                <tr class="clickable" onclick='openChartModal(${JSON.stringify({ticker:s.ticker,name:s.name,price:s.price,change_rate:s.change_rate})})'>
                    <td><div class="stock-name">${s.name}</div><div class="stock-ticker">${s.ticker}</div></td>
                    <td class="text-right">${formatNumber(s.price)}ì›</td>
                    <td class="text-right ${getColor(s.change_rate)}">${formatPercent(s.change_rate)}</td>
                    <td class="text-right">${formatMarketCap(s.market_cap)}</td>
                    <td class="text-right">${formatNumber(s.box_high)}ì›</td>
                    <td class="text-right">${formatNumber(s.box_low)}ì›</td>
                    <td class="text-right">${formatPercent(s.range_percent)}</td>
                    <td class="text-center">${s.support_touches}/${s.resistance_touches}</td>
                    <td class="text-right">${s.atr_multiple.toFixed(1)}x</td>
                    <td class="text-right">${s.days || 60}ì¼</td>
                </tr>
            `).join('');
            renderTable('box-range-table', headers, rows, renderBoxRange);
            renderPagination('box-range-pagination', 'boxRange', sortedData.length, renderBoxRange);
        }

        function renderBoxBreakout() {
            // í•„í„° ì ìš©
            let filteredData = DATA.boxBreakout.data;
            if (filterMA150State.boxBreakout) {
                filteredData = filteredData.filter(s => s.above_ma150 === true || (s.ma150 && s.price > s.ma150));
            }

            const countEl = document.getElementById('box-breakout-count');
            if (filterMA150State.boxBreakout) {
                countEl.textContent = filteredData.length + 'ê°œ / ì „ì²´ ' + DATA.boxBreakout.meta.totalCount;
            } else {
                countEl.textContent = DATA.boxBreakout.meta.totalCount;
            }

            const headers = [
                { label: 'ì¢…ëª©ëª…', key: 'name' }, { label: 'í˜„ì¬ê°€', align: 'text-right', key: 'price' },
                { label: 'ë“±ë½ë¥ ', align: 'text-right', key: 'change_rate' }, { label: 'ì‹œê°€ì´ì•¡', align: 'text-right', key: 'market_cap' },
                { label: 'ëŒíŒŒì¼', key: 'breakout_date' }, { label: 'ëŒíŒŒê°€', align: 'text-right', key: 'breakout_price' },
                { label: 'ê±°ë˜ëŸ‰ë¹„', align: 'text-right', key: 'volume_ratio' }, { label: '150ì¼ì„ ', align: 'text-right', key: 'ma150' }
            ];
            const state = sortState['box-breakout-table'] || {};
            const sortedData = sortData(filteredData, state.key, state.direction);
            const paginatedData = paginate(sortedData, paginationState.boxBreakout);
            const rows = paginatedData.map(s => `
                <tr class="clickable" onclick='openChartModal(${JSON.stringify({ticker:s.ticker,name:s.name,price:s.price,change_rate:s.change_rate})})'>
                    <td><div class="stock-name">${s.name}</div><div class="stock-ticker">${s.ticker}</div></td>
                    <td class="text-right">${formatNumber(s.price)}ì›</td>
                    <td class="text-right ${getColor(s.change_rate)}">${formatPercent(s.change_rate)}</td>
                    <td class="text-right">${formatMarketCap(s.market_cap)}</td>
                    <td>${formatShortDate(s.breakout_date)}</td>
                    <td class="text-right">${formatNumber(s.breakout_price)}ì›</td>
                    <td class="text-right">${s.volume_ratio.toFixed(1)}x</td>
                    <td class="text-right">${formatNumber(s.ma150)}ì›</td>
                </tr>
            `).join('');
            renderTable('box-breakout-table', headers, rows, renderBoxBreakout);
            renderPagination('box-breakout-pagination', 'boxBreakout', sortedData.length, renderBoxBreakout);
        }

        function renderBoxBreakoutSimple() {
            // í•„í„° ì ìš©
            let filteredData = DATA.boxBreakoutSimple.data;
            if (filterMA150State.boxBreakoutSimple) {
                filteredData = filteredData.filter(s => s.above_ma150 === true || (s.ma150 && s.price > s.ma150));
            }

            const countEl = document.getElementById('box-breakout-simple-count');
            if (filterMA150State.boxBreakoutSimple) {
                countEl.textContent = filteredData.length + 'ê°œ / ì „ì²´ ' + DATA.boxBreakoutSimple.meta.totalCount;
            } else {
                countEl.textContent = DATA.boxBreakoutSimple.meta.totalCount;
            }

            const headers = [
                { label: 'ì¢…ëª©ëª…', key: 'name' }, { label: 'í˜„ì¬ê°€', align: 'text-right', key: 'price' },
                { label: 'ë“±ë½ë¥ ', align: 'text-right', key: 'change_rate' }, { label: 'ì‹œê°€ì´ì•¡', align: 'text-right', key: 'market_cap' },
                { label: 'ëŒíŒŒì¼', key: 'breakout_date' }, { label: 'ì €í•­ì„ ', align: 'text-right', key: 'resistance' },
                { label: 'ê²½ê³¼ì¼', align: 'text-right', key: 'days_since_breakout' }, { label: 'ì €í•­ì„ ëŒ€ë¹„', align: 'text-right', key: 'current_vs_resistance' }
            ];
            const state = sortState['box-breakout-simple-table'] || {};
            const sortedData = sortData(filteredData, state.key, state.direction);
            const paginatedData = paginate(sortedData, paginationState.boxBreakoutSimple);
            const rows = paginatedData.map(s => `
                <tr class="clickable" onclick='openChartModal(${JSON.stringify({ticker:s.ticker,name:s.name,price:s.price,change_rate:s.change_rate})})'>
                    <td><div class="stock-name">${s.name}</div><div class="stock-ticker">${s.ticker}</div></td>
                    <td class="text-right">${formatNumber(s.price)}ì›</td>
                    <td class="text-right ${getColor(s.change_rate)}">${formatPercent(s.change_rate)}</td>
                    <td class="text-right">${formatMarketCap(s.market_cap)}</td>
                    <td>${formatShortDate(s.breakout_date)}</td>
                    <td class="text-right">${formatNumber(s.resistance)}ì›</td>
                    <td class="text-right">${s.days_since_breakout}ì¼</td>
                    <td class="text-right">${s.current_vs_resistance.toFixed(1)}%</td>
                </tr>
            `).join('');
            renderTable('box-breakout-simple-table', headers, rows, renderBoxBreakoutSimple);
            renderPagination('box-breakout-simple-pagination', 'boxBreakoutSimple', sortedData.length, renderBoxBreakoutSimple);
        }

        function renderPullback() {
            // í•„í„° ì ìš©
            let filteredData = DATA.pullback.data;
            if (filterMA150State.pullback) {
                filteredData = filteredData.filter(s => s.above_ma150 === true || (s.ma150 && s.price > s.ma150));
            }

            const countEl = document.getElementById('pullback-count');
            if (filterMA150State.pullback) {
                countEl.textContent = filteredData.length + 'ê°œ / ì „ì²´ ' + DATA.pullback.meta.totalCount;
            } else {
                countEl.textContent = DATA.pullback.meta.totalCount;
            }

            const headers = [
                { label: 'ì¢…ëª©ëª…', key: 'name' }, { label: 'í˜„ì¬ê°€', align: 'text-right', key: 'price' },
                { label: 'ë“±ë½ë¥ ', align: 'text-right', key: 'change_rate' }, { label: 'ì‹œê°€ì´ì•¡', align: 'text-right', key: 'market_cap' },
                { label: 'ëŒíŒŒì¼', key: 'breakout_date' }, { label: 'ì €í•­ì„ ', align: 'text-right', key: 'resistance' },
                { label: 'í’€ë°±ë¥ ', align: 'text-right', key: 'pullback_ratio' }, { label: 'ê±°ë˜ëŸ‰ê°ì†Œ', align: 'text-right', key: 'volume_decrease' }
            ];
            const state = sortState['pullback-table'] || {};
            const sortedData = sortData(filteredData, state.key, state.direction);
            const paginatedData = paginate(sortedData, paginationState.pullback);
            const rows = paginatedData.map(s => `
                <tr class="clickable" onclick='openChartModal(${JSON.stringify({ticker:s.ticker,name:s.name,price:s.price,change_rate:s.change_rate})})'>
                    <td><div class="stock-name">${s.name}</div><div class="stock-ticker">${s.ticker}</div></td>
                    <td class="text-right">${formatNumber(s.price)}ì›</td>
                    <td class="text-right ${getColor(s.change_rate)}">${formatPercent(s.change_rate)}</td>
                    <td class="text-right">${formatMarketCap(s.market_cap)}</td>
                    <td>${formatShortDate(s.breakout_date)}</td>
                    <td class="text-right">${formatNumber(s.resistance)}ì›</td>
                    <td class="text-right">${s.pullback_ratio.toFixed(1)}%</td>
                    <td class="text-right" style="color: var(--color-success)">-${s.volume_decrease}%</td>
                </tr>
            `).join('');
            renderTable('pullback-table', headers, rows, renderPullback);
            renderPagination('pullback-pagination', 'pullback', sortedData.length, renderPullback);
        }

        function renderVolumeDryUp() {
            // í•„í„° ì ìš©
            let filteredData = DATA.volumeDryUp.data;
            if (filterMA150State.volumeDryUp) {
                filteredData = filteredData.filter(s => s.above_ma150 === true || (s.ma150 && s.price > s.ma150));
            }

            const countEl = document.getElementById('volume-dry-up-count');
            if (filterMA150State.volumeDryUp) {
                countEl.textContent = filteredData.length + 'ê°œ / ì „ì²´ ' + DATA.volumeDryUp.meta.totalCount;
            } else {
                countEl.textContent = DATA.volumeDryUp.meta.totalCount;
            }

            const headers = [
                { label: 'ì¢…ëª©ëª…', key: 'name' }, { label: 'í˜„ì¬ê°€', align: 'text-right', key: 'price' },
                { label: 'ì‹œê°€ì´ì•¡', align: 'text-right', key: 'market_cap' },
                { label: 'ê¸‰ë“±ì¼', key: 'explosion_date' }, { label: 'ê¸‰ë“±í­', align: 'text-right', key: 'explosion_change_rate' },
                { label: 'ê±°ë˜ëŸ‰ë¹„', align: 'text-right', key: 'explosion_volume_ratio' },
                { label: 'ê²½ê³¼ì¼', align: 'text-right', key: 'days_since_explosion' },
                { label: 'ê±°ë˜ëŸ‰ê°ì†Œ', align: 'text-right', key: 'volume_decrease_rate' }
            ];
            const state = sortState['volume-dry-up-table'] || {};
            const sortedData = sortData(filteredData, state.key, state.direction);
            const paginatedData = paginate(sortedData, paginationState.volumeDryUp);
            const rows = paginatedData.map(s => `
                <tr class="clickable" onclick='openChartModal(${JSON.stringify({ticker:s.ticker,name:s.name,price:s.price,change_rate:0})})'>
                    <td><div class="stock-name">${s.name}</div><div class="stock-ticker">${s.ticker}</div></td>
                    <td class="text-right">${formatNumber(s.price)}ì›</td>
                    <td class="text-right">${formatMarketCap(s.market_cap)}</td>
                    <td>${formatShortDate(s.explosion_date)}</td>
                    <td class="text-right positive">+${s.explosion_change_rate.toFixed(1)}%</td>
                    <td class="text-right" style="color: var(--color-warning)">${(s.explosion_volume_ratio || 0).toFixed(1)}x</td>
                    <td class="text-right">${s.days_since_explosion || 0}ì¼</td>
                    <td class="text-right" style="color: var(--color-success)">-${s.volume_decrease_rate}%</td>
                </tr>
            `).join('');
            renderTable('volume-dry-up-table', headers, rows, renderVolumeDryUp);
            renderPagination('volume-dry-up-pagination', 'volumeDryUp', sortedData.length, renderVolumeDryUp);
        }

        function renderVolumeExplosion() {
            // í•„í„° ì ìš©
            let filteredData = DATA.volumeExplosion.data;
            if (filterMA150State.volumeExplosion) {
                filteredData = filteredData.filter(s => s.above_ma150 === true || (s.ma150 && s.price > s.ma150));
            }

            const countEl = document.getElementById('volume-explosion-count');
            if (filterMA150State.volumeExplosion) {
                countEl.textContent = filteredData.length + 'ê°œ / ì „ì²´ ' + DATA.volumeExplosion.meta.totalCount;
            } else {
                countEl.textContent = DATA.volumeExplosion.meta.totalCount;
            }

            const headers = [
                { label: 'ì¢…ëª©ëª…', key: 'name' }, { label: 'í˜„ì¬ê°€', align: 'text-right', key: 'price' },
                { label: 'ë“±ë½ë¥ ', align: 'text-right', key: 'change_rate' }, { label: 'ì‹œê°€ì´ì•¡', align: 'text-right', key: 'market_cap' },
                { label: 'ê±°ë˜ëŸ‰ë¹„', align: 'text-right', key: 'volume_ratio' }, { label: 'ìˆœìœ„', align: 'text-right', key: 'volume_rank' }
            ];
            const state = sortState['volume-explosion-table'] || {};
            const sortedData = sortData(filteredData, state.key, state.direction);
            const paginatedData = paginate(sortedData, paginationState.volumeExplosion);
            const rows = paginatedData.map(s => `
                <tr class="clickable" onclick='openChartModal(${JSON.stringify({ticker:s.ticker,name:s.name,price:s.price,change_rate:s.change_rate})})'>
                    <td><div class="stock-name">${s.name}</div><div class="stock-ticker">${s.ticker}</div></td>
                    <td class="text-right">${formatNumber(s.price)}ì›</td>
                    <td class="text-right ${getColor(s.change_rate)}">${formatPercent(s.change_rate)}</td>
                    <td class="text-right">${formatMarketCap(s.market_cap)}</td>
                    <td class="text-right">${s.volume_ratio.toFixed(1)}x</td>
                    <td class="text-right">${s.volume_rank}ìœ„</td>
                </tr>
            `).join('');
            renderTable('volume-explosion-table', headers, rows, renderVolumeExplosion);
            renderPagination('volume-explosion-pagination', 'volumeExplosion', sortedData.length, renderVolumeExplosion);
        }

        function renderNewHigh52w() {
            document.getElementById('new-high-52w-count').textContent = DATA.newHigh52w.meta.totalCount;

            const headers = [
                { label: 'ì¢…ëª©ëª…', key: 'name' }, { label: 'í˜„ì¬ê°€', align: 'text-right', key: 'price' },
                { label: 'ë“±ë½ë¥ ', align: 'text-right', key: 'change_rate' }, { label: 'ì‹œê°€ì´ì•¡', align: 'text-right', key: 'market_cap' },
                { label: '52ì£¼ ì‹ ê³ ê°€', align: 'text-right', key: 'high_52w' },
                { label: 'ì‹ ê³ ê°€ ëŒ€ë¹„', align: 'text-right', key: 'above_high_percent' },
                { label: 'ëŒíŒŒ í›„', align: 'text-right', key: 'days_since' }
            ];
            const state = sortState['new-high-52w-table'] || {};
            const sortedData = sortData(DATA.newHigh52w.data, state.key, state.direction);
            const paginatedData = paginate(sortedData, paginationState.newHigh52w);
            const rows = paginatedData.map(s => `
                <tr class="clickable" onclick='openChartModal(${JSON.stringify({ticker:s.ticker,name:s.name,price:s.price,change_rate:s.change_rate})})'>
                    <td><div class="stock-name">${s.name}</div><div class="stock-ticker">${s.ticker}</div></td>
                    <td class="text-right">${formatNumber(s.price)}ì›</td>
                    <td class="text-right ${getColor(s.change_rate)}">${formatPercent(s.change_rate)}</td>
                    <td class="text-right">${formatMarketCap(s.market_cap)}</td>
                    <td class="text-right">${formatNumber(s.high_52w)}ì›</td>
                    <td class="text-right positive">+${s.above_high_percent.toFixed(1)}%</td>
                    <td class="text-right">${s.days_since}ì¼</td>
                </tr>
            `).join('');
            renderTable('new-high-52w-table', headers, rows, renderNewHigh52w);
            renderPagination('new-high-52w-pagination', 'newHigh52w', sortedData.length, renderNewHigh52w);
        }

        function renderSectorStage() {
            document.getElementById('sector-stage-count').textContent = DATA.sectorStage.meta.totalCount;
            const grouped = { 1: [], 2: [], 3: [], 4: [] };
            DATA.sectorStage.data.forEach(s => grouped[s.stage]?.push(s));
            const stageEmoji = { 1: '1ï¸âƒ£', 2: '2ï¸âƒ£', 3: '3ï¸âƒ£', 4: '4ï¸âƒ£' };
            const stageLabel = { 1: 'ê¸°ì´ˆ', 2: 'ìƒìŠ¹', 3: 'ìµœì •ìƒ', 4: 'ì‡ í‡´' };
            const stageBadge = { 1: 'íš¡ë³´ êµ¬ê°„', 2: 'ë§¤ìˆ˜ ì ê¸°', 3: 'ë§¤ë„ ì¤€ë¹„', 4: 'ë§¤ë„/ê´€ë§' };
            const stageBgClass = { 1: 'stage-1-bg', 2: 'stage-2-bg', 3: 'stage-3-bg', 4: 'stage-4-bg' };

            let html = '';
            [2, 1, 3, 4].forEach(stage => {
                if (grouped[stage]?.length > 0) {
                    html += `
                        <section class="sector-section">
                            <h2><span class="stage-${stage}">${stageEmoji[stage]} ${stageLabel[stage]} ë‹¨ê³„</span>
                            <span class="section-badge stage-${stage}-bg stage-${stage}">${stageBadge[stage]}</span></h2>
                            <div class="sector-cards">
                                ${grouped[stage].map(s => {
                                    const priceVsMa = ((s.current_price - s.ma150) / s.ma150) * 100;
                                    return `
                                        <div class="card sector-card ${stageBgClass[s.stage]}">
                                            <div class="header">
                                                <span class="sector-name">${s.sector_name}</span>
                                                <div class="stage-badge">
                                                    <span class="emoji">${stageEmoji[s.stage]}</span>
                                                    <span class="name stage-${s.stage}">${s.stage_name}</span>
                                                </div>
                                            </div>
                                            <div class="metrics">
                                                <div class="metric"><span class="metric-label">í˜„ì¬ ì§€ìˆ˜</span><span>${formatNumber(s.current_price)}</span></div>
                                                <div class="metric"><span class="metric-label">150ì¼ì„  ëŒ€ë¹„</span><span class="${getColor(priceVsMa)}">${formatPercent(priceVsMa)}</span></div>
                                                <div class="metric"><span class="metric-label">MA ê¸°ìš¸ê¸°</span><span class="${getColor(s.ma150_slope)}">${formatPercent(s.ma150_slope)}</span></div>
                                                <div class="metric"><span class="metric-label">3ê°œì›” ìˆ˜ìµë¥ </span><span class="${getColor(s.return_3m)}">${formatPercent(s.return_3m)}</span></div>
                                            </div>
                                            ${s.is_overheated ? '<div class="overheated">ğŸ”¥ 6ê°œì›” ì—°ì† ìƒìŠ¹ - ê³¼ì—´ ì£¼ì˜</div>' : ''}
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </section>
                    `;
                }
            });
            document.getElementById('sector-stage-content').innerHTML = html;
        }

        // Navigation
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(`page-${pageId}`).classList.add('active');
            window.scrollTo(0, 0);
        }

        // ì•± ì´ˆê¸°í™” í•¨ìˆ˜
        async function initApp() {
            // 1. ì™¸ë¶€ JSON ë°ì´í„° ë¡œë“œ
            const success = await loadAllData();

            // 2. ë¡œë”© UI ìˆ¨ê¸°ê¸°
            hideLoadingState();

            if (!success) {
                console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨ - ì•± ì´ˆê¸°í™” ì¤‘ë‹¨');
                return;
            }

            // 3. UI ë Œë”ë§
            renderHome();
            updatePageDates();
            renderBoxRange();
            renderBoxBreakout();
            renderBoxBreakoutSimple();
            renderPullback();
            renderVolumeDryUp();
            renderVolumeExplosion();
            renderNewHigh52w();
            renderSectorStage();

            console.log('âœ… ì•± ì´ˆê¸°í™” ì™„ë£Œ');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì•± ì‹œì‘
        initApp();
    </script>
</body>
</html>
